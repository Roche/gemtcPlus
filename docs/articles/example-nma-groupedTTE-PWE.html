<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian FE &amp; RE NMA using piecewise exponential model • gemtcPlus</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Bayesian FE &amp; RE NMA using piecewise exponential model">
<meta property="og:description" content="gemtcPlus">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SGZFXJEC6X"></script><script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date());
gtag('config', 'G-SGZFXJEC6X'); </script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gemtcPlus</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Other Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://roche.github.io/Global-HTA-Evidence-Open/index.html" class="external-link">Global-HTA-Evidence-Open</a>
    </li>
    <li>
      <a href="https://roche.github.io/flexsurvPlus/index.html" class="external-link">flexsurvPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/gemtcPlus/index.html" class="external-link">gemtcPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/MAIC/index.html" class="external-link">MAIC</a>
    </li>
    <li>
      <a href="https://roche.github.io/rpsftmPlus/index.html" class="external-link">rpsftmPlus</a>
    </li>
    <li>
      <a href="https://roche.github.io/descem/index.html" class="external-link">descem</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Roche/gemtcPlus" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Bayesian FE &amp; RE NMA using piecewise exponential model</h1>
                        <h4 data-toc-skip class="author">Sandro Gsteiger</h4>
            
            <h4 data-toc-skip class="date">2022-07-26</h4>
      
      
      <div class="hidden name"><code>example-nma-groupedTTE-PWE.Rmd</code></div>

    </div>

    
    
<p><em>“Minimal” example that might serve as template</em></p>
<div class="section level3">
<h3 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h3>
<p>This vignette provides a short example of a Bayesian piecewise exponential (PWE) NMA for grouped survival data. The model fit calls jags via the <code>R2jags</code> package. Pre- and post-processing is done with <code>gemtcPlus</code>.</p>
</div>
<div class="section level3">
<h3 id="prepare-the-environment">Prepare the environment<a class="anchor" aria-label="anchor" href="#prepare-the-environment"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gertvv/gemtc" class="external-link">gemtc</a></span><span class="op">)</span>        </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gemtcPlus</span><span class="op">)</span>     </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://xavier-fim.net/packages/ggmcmc/" class="external-link">ggmcmc</a></span><span class="op">)</span>       </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="load-input-data">Load input data<a class="anchor" aria-label="anchor" href="#load-input-data"></a>
</h2>
<p>The PWE NMA for grouped survival data requires columns “study”, “treatment”, “t.start” and “t.end” (identifying the time interval), “n.event”, “n.censored”, and “n.risk” (identifying the observed events, numbers of censorings, and patients at risk for the given interval).</p>
<p>The <code>gemtcPlus</code> package contains such an example data set.</p>
<div class="section level3">
<h3 id="load-in-the-data">Load in the data<a class="anchor" aria-label="anchor" href="#load-in-the-data"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"grouped_TTE"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plan-the-model">Plan the model<a class="anchor" aria-label="anchor" href="#plan-the-model"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_plan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plan_pwe.html">plan_pwe</a></span><span class="op">(</span>model.pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cut.pts <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       bth.model <span class="op">=</span> <span class="st">"FE"</span>, ref.std <span class="op">=</span> <span class="st">"STUDY2"</span>, nma.ref.trt <span class="op">=</span> <span class="st">"B"</span>,</span>
<span>                       n.chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                       n.iter <span class="op">=</span> <span class="fl">6000</span>,</span>
<span>                       n.burnin <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                       n.thin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ready-the-data">Ready the data<a class="anchor" aria-label="anchor" href="#ready-the-data"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Returns list list contaiing a jags list ready for input to `nma_fit` and a network object</span></span>
<span><span class="va">model_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma_pre_proc.html">nma_pre_proc</a></span><span class="op">(</span><span class="va">grouped_TTE</span>, <span class="va">model_plan</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-the-model">Fit the model<a class="anchor" aria-label="anchor" href="#fit-the-model"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma_fit.html">nma_fit</a></span><span class="op">(</span>model_input <span class="op">=</span> <span class="va">model_input</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## module glm loaded</span></span></code></pre>
<pre><code><span><span class="co">## Compiling model graph</span></span>
<span><span class="co">##    Resolving undeclared variables</span></span>
<span><span class="co">##    Allocating nodes</span></span>
<span><span class="co">## Graph information:</span></span>
<span><span class="co">##    Observed stochastic nodes: 675</span></span>
<span><span class="co">##    Unobserved stochastic nodes: 36</span></span>
<span><span class="co">##    Total graph size: 5085</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Initializing model</span></span></code></pre>
<p>JAGS summary. Check convergence by inspecting Rhat (should be at least &lt;1.05), and see whether the effective sample size is large enough to allow for inference (rule of thumb: n.eff &gt;1000, though this may be demanding).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## Inference for Bugs model at "/tmp/RtmpiQa6Pm/temp_libpath844d447c83dc/gemtcPlus/BUGScode/gsd_piece-wise-cst_fe.txt", fit using jags,</span></span>
<span><span class="co">##  2 chains, each with 6000 iterations (first 1000 discarded)</span></span>
<span><span class="co">##  n.sims = 10000 iterations saved</span></span>
<span><span class="co">##           mu.vect sd.vect     2.5%      25%      50%      75%    97.5%  Rhat</span></span>
<span><span class="co">## d[1,1]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">## d[2,1]     -0.241   0.298   -0.831   -0.441   -0.241   -0.042    0.348 1.001</span></span>
<span><span class="co">## d[3,1]     -0.401   0.333   -1.066   -0.623   -0.399   -0.181    0.254 1.001</span></span>
<span><span class="co">## d[4,1]      0.956   0.372    0.255    0.708    0.943    1.182    1.765 1.013</span></span>
<span><span class="co">## d[5,1]      0.616   0.435   -0.213    0.328    0.601    0.899    1.520 1.010</span></span>
<span><span class="co">## d[6,1]     -0.616   0.713   -2.035   -1.081   -0.616   -0.150    0.799 1.003</span></span>
<span><span class="co">## d[1,2]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">## d[2,2]     -0.257   0.142   -0.538   -0.352   -0.259   -0.162    0.025 1.001</span></span>
<span><span class="co">## d[3,2]      0.174   0.198   -0.202    0.037    0.175    0.307    0.564 1.004</span></span>
<span><span class="co">## d[4,2]      0.171   0.190   -0.201    0.043    0.169    0.300    0.545 1.001</span></span>
<span><span class="co">## d[5,2]     -0.099   0.220   -0.534   -0.249   -0.099    0.051    0.336 1.003</span></span>
<span><span class="co">## d[6,2]      0.963   0.366    0.258    0.715    0.961    1.211    1.689 1.002</span></span>
<span><span class="co">## d[1,3]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">## d[2,3]      0.003   0.092   -0.176   -0.059    0.002    0.065    0.185 1.002</span></span>
<span><span class="co">## d[3,3]      0.033   0.151   -0.266   -0.067    0.033    0.132    0.337 1.005</span></span>
<span><span class="co">## d[4,3]      0.088   0.134   -0.178   -0.001    0.089    0.179    0.346 1.001</span></span>
<span><span class="co">## d[5,3]      0.050   0.155   -0.255   -0.054    0.051    0.155    0.347 1.001</span></span>
<span><span class="co">## d[6,3]     -0.050   0.230   -0.500   -0.203   -0.048    0.105    0.394 1.004</span></span>
<span><span class="co">## mu[1,1]    -3.678   0.252   -4.202   -3.843   -3.667   -3.504   -3.216 1.001</span></span>
<span><span class="co">## mu[2,1]    -3.611   0.169   -3.948   -3.724   -3.607   -3.496   -3.288 1.002</span></span>
<span><span class="co">## mu[3,1]    -3.856   0.196   -4.254   -3.987   -3.851   -3.722   -3.485 1.001</span></span>
<span><span class="co">## mu[4,1]    -4.669   0.315   -5.362   -4.863   -4.650   -4.452   -4.102 1.012</span></span>
<span><span class="co">## mu[5,1]    -4.568   0.420   -5.471   -4.831   -4.538   -4.276   -3.824 1.002</span></span>
<span><span class="co">## mu[6,1]    -4.684   0.240   -5.167   -4.839   -4.676   -4.516   -4.238 1.001</span></span>
<span><span class="co">## mu[7,1]    -3.641   0.243   -4.136   -3.801   -3.637   -3.470   -3.185 1.001</span></span>
<span><span class="co">## mu[1,2]    -3.720   0.173   -4.066   -3.838   -3.713   -3.599   -3.394 1.001</span></span>
<span><span class="co">## mu[2,2]    -3.042   0.092   -3.229   -3.103   -3.041   -2.979   -2.865 1.002</span></span>
<span><span class="co">## mu[3,2]    -3.275   0.103   -3.478   -3.344   -3.275   -3.206   -3.072 1.002</span></span>
<span><span class="co">## mu[4,2]    -3.682   0.134   -3.956   -3.770   -3.677   -3.591   -3.431 1.001</span></span>
<span><span class="co">## mu[5,2]    -4.331   0.252   -4.853   -4.494   -4.322   -4.157   -3.863 1.001</span></span>
<span><span class="co">## mu[6,2]    -3.783   0.110   -4.003   -3.857   -3.782   -3.709   -3.573 1.001</span></span>
<span><span class="co">## mu[7,2]    -3.698   0.173   -4.039   -3.812   -3.698   -3.579   -3.367 1.003</span></span>
<span><span class="co">## mu[1,3]    -3.783   0.129   -4.044   -3.868   -3.781   -3.694   -3.538 1.003</span></span>
<span><span class="co">## mu[2,3]    -3.382   0.067   -3.515   -3.427   -3.381   -3.336   -3.254 1.001</span></span>
<span><span class="co">## mu[3,3]    -3.498   0.072   -3.642   -3.545   -3.497   -3.450   -3.359 1.001</span></span>
<span><span class="co">## mu[4,3]    -3.622   0.093   -3.812   -3.682   -3.621   -3.559   -3.444 1.001</span></span>
<span><span class="co">## mu[5,3]    -3.779   0.119   -4.018   -3.860   -3.778   -3.697   -3.548 1.002</span></span>
<span><span class="co">## mu[6,3]    -3.715   0.065   -3.844   -3.758   -3.714   -3.671   -3.588 1.001</span></span>
<span><span class="co">## mu[7,3]    -3.597   0.131   -3.858   -3.684   -3.596   -3.508   -3.344 1.002</span></span>
<span><span class="co">## deviance 2629.317   8.504 2614.625 2623.282 2628.734 2634.664 2647.734 1.002</span></span>
<span><span class="co">##          n.eff</span></span>
<span><span class="co">## d[1,1]       1</span></span>
<span><span class="co">## d[2,1]    6700</span></span>
<span><span class="co">## d[3,1]    5400</span></span>
<span><span class="co">## d[4,1]     220</span></span>
<span><span class="co">## d[5,1]     290</span></span>
<span><span class="co">## d[6,1]     700</span></span>
<span><span class="co">## d[1,2]       1</span></span>
<span><span class="co">## d[2,2]    5400</span></span>
<span><span class="co">## d[3,2]     570</span></span>
<span><span class="co">## d[4,2]    2700</span></span>
<span><span class="co">## d[5,2]     920</span></span>
<span><span class="co">## d[6,2]    1800</span></span>
<span><span class="co">## d[1,3]       1</span></span>
<span><span class="co">## d[2,3]    1500</span></span>
<span><span class="co">## d[3,3]     380</span></span>
<span><span class="co">## d[4,3]    9500</span></span>
<span><span class="co">## d[5,3]    5000</span></span>
<span><span class="co">## d[6,3]     500</span></span>
<span><span class="co">## mu[1,1]  10000</span></span>
<span><span class="co">## mu[2,1]   2400</span></span>
<span><span class="co">## mu[3,1]  10000</span></span>
<span><span class="co">## mu[4,1]    250</span></span>
<span><span class="co">## mu[5,1]   1700</span></span>
<span><span class="co">## mu[6,1]   4800</span></span>
<span><span class="co">## mu[7,1]   3800</span></span>
<span><span class="co">## mu[1,2]   7300</span></span>
<span><span class="co">## mu[2,2]   2000</span></span>
<span><span class="co">## mu[3,2]   1500</span></span>
<span><span class="co">## mu[4,2]  10000</span></span>
<span><span class="co">## mu[5,2]  10000</span></span>
<span><span class="co">## mu[6,2]  10000</span></span>
<span><span class="co">## mu[7,2]    820</span></span>
<span><span class="co">## mu[1,3]    660</span></span>
<span><span class="co">## mu[2,3]  10000</span></span>
<span><span class="co">## mu[3,3]   7300</span></span>
<span><span class="co">## mu[4,3]  10000</span></span>
<span><span class="co">## mu[5,3]   2500</span></span>
<span><span class="co">## mu[6,3]  10000</span></span>
<span><span class="co">## mu[7,3]   2000</span></span>
<span><span class="co">## deviance   950</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## For each parameter, n.eff is a crude measure of effective sample size,</span></span>
<span><span class="co">## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## DIC info (using the rule, pD = Dbar-Dhat)</span></span>
<span><span class="co">## pD = 36.0 and DIC = 2665.3</span></span>
<span><span class="co">## DIC is an estimate of expected predictive error (lower deviance is better).</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="post-processing">Post processing<a class="anchor" aria-label="anchor" href="#post-processing"></a>
</h3>
<p>Produce diagnostic plots to further assess convergence. Here: select the contrasts trt 2 vs trt 1 for visibility.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare plot data</span></span>
<span><span class="va">nodes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">sel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"d[2,"</span>, <span class="va">nodes</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">plot_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html" class="external-link">ggs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span><span class="op">[</span>, <span class="va">sel</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><strong>Figure</strong> Traceplot</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_traceplot.html" class="external-link">ggs_traceplot</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-8-1.png" width="576"></p>
<p><strong>Figure</strong> Densityplot</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_density.html" class="external-link">ggs_density</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<p><strong>Figure</strong> Auto-correlation plot</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_autocorrelation.html" class="external-link">ggs_autocorrelation</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p><strong>Figure</strong> Running means</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_running.html" class="external-link">ggs_running</a></span><span class="op">(</span><span class="va">plot_data</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>Save the FE results for later use.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fixed_effect_model</span> <span class="op">&lt;-</span> <span class="va">model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="random-effects-model">Random effects model<a class="anchor" aria-label="anchor" href="#random-effects-model"></a>
</h4>
<p><strong>Informative prior by Turner et al. LN(-4.2, 1.4^2)</strong> Create a new plan and run-run the fit for the random effects model.</p>
</div>
</div>
<div class="section level3">
<h3 id="plan-the-model-1">Plan the model<a class="anchor" aria-label="anchor" href="#plan-the-model-1"></a>
</h3>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_plan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plan_pwe.html">plan_pwe</a></span><span class="op">(</span>model.pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cut.pts <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                       bth.model <span class="op">=</span> <span class="st">"RE"</span>, ref.std <span class="op">=</span> <span class="st">"STUDY2"</span>, nma.ref.trt <span class="op">=</span> <span class="st">"B"</span>,</span>
<span>                    </span>
<span>                       n.chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                       n.iter <span class="op">=</span> <span class="fl">6000</span>,</span>
<span>                       n.burnin <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                       n.thin <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                       bth.prior <span class="op">=</span> <span class="fu"><a href="../reference/bth_prior.html">bth_prior</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"var"</span>, distr <span class="op">=</span> <span class="st">"ln"</span>, param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fl">1</span>, prec <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Returns list list contaiing a jags list ready for input to `nma_fit` and a network object</span></span>
<span><span class="va">model_input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma_pre_proc.html">nma_pre_proc</a></span><span class="op">(</span><span class="va">grouped_TTE</span>, <span class="va">model_plan</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-the-model-1">Fit the model<a class="anchor" aria-label="anchor" href="#fit-the-model-1"></a>
</h3>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span>  <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nma_fit.html">nma_fit</a></span><span class="op">(</span>model_input <span class="op">=</span> <span class="va">model_input</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Compiling model graph</span></span>
<span><span class="co">##    Resolving undeclared variables</span></span>
<span><span class="co">##    Allocating nodes</span></span>
<span><span class="co">## Graph information:</span></span>
<span><span class="co">##    Observed stochastic nodes: 675</span></span>
<span><span class="co">##    Unobserved stochastic nodes: 58</span></span>
<span><span class="co">##    Total graph size: 5788</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Initializing model</span></span></code></pre>
<p>JAGS summary. Inspect Rhat and n.eff.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span></span></code></pre></div>
<pre><code><span><span class="co">## Inference for Bugs model at "/tmp/RtmpiQa6Pm/temp_libpath844d447c83dc/gemtcPlus/BUGScode/gsd_piece-wise-cst_re-var-ln.txt", fit using jags,</span></span>
<span><span class="co">##  2 chains, each with 6000 iterations (first 1000 discarded)</span></span>
<span><span class="co">##  n.sims = 10000 iterations saved</span></span>
<span><span class="co">##           mu.vect sd.vect     2.5%      25%      50%      75%    97.5%  Rhat</span></span>
<span><span class="co">## d[1,1]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">## d[2,1]     -0.273   0.734   -1.747   -0.709   -0.261    0.166    1.181 1.001</span></span>
<span><span class="co">## d[3,1]     -0.426   0.754   -1.940   -0.886   -0.410    0.029    1.047 1.002</span></span>
<span><span class="co">## d[4,1]      0.927   0.900   -0.903    0.384    0.929    1.464    2.707 1.002</span></span>
<span><span class="co">## d[5,1]      0.591   1.103   -1.675   -0.048    0.596    1.244    2.783 1.001</span></span>
<span><span class="co">## d[6,1]     -0.635   1.280   -3.213   -1.429   -0.635    0.163    1.863 1.001</span></span>
<span><span class="co">## d[1,2]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">## d[2,2]     -0.261   0.686   -1.652   -0.653   -0.259    0.138    1.123 1.002</span></span>
<span><span class="co">## d[3,2]      0.162   0.698   -1.260   -0.241    0.165    0.569    1.585 1.001</span></span>
<span><span class="co">## d[4,2]      0.178   0.834   -1.517   -0.306    0.163    0.656    1.869 1.004</span></span>
<span><span class="co">## d[5,2]     -0.095   1.027   -2.134   -0.694   -0.114    0.487    2.035 1.003</span></span>
<span><span class="co">## d[6,2]      0.959   1.127   -1.383    0.303    0.963    1.629    3.199 1.001</span></span>
<span><span class="co">## d[1,3]      0.000   0.000    0.000    0.000    0.000    0.000    0.000 1.000</span></span>
<span><span class="co">## d[2,3]     -0.001   0.679   -1.389   -0.392    0.004    0.395    1.346 1.002</span></span>
<span><span class="co">## d[3,3]      0.030   0.688   -1.347   -0.362    0.027    0.433    1.428 1.002</span></span>
<span><span class="co">## d[4,3]      0.096   0.831   -1.574   -0.375    0.085    0.576    1.808 1.001</span></span>
<span><span class="co">## d[5,3]      0.058   1.011   -2.013   -0.520    0.057    0.623    2.115 1.002</span></span>
<span><span class="co">## d[6,3]     -0.054   1.094   -2.249   -0.676   -0.058    0.573    2.147 1.002</span></span>
<span><span class="co">## mu[1,1]    -3.609   0.257   -4.139   -3.774   -3.600   -3.433   -3.134 1.002</span></span>
<span><span class="co">## mu[2,1]    -3.610   0.183   -3.989   -3.726   -3.603   -3.483   -3.267 1.001</span></span>
<span><span class="co">## mu[3,1]    -3.869   0.219   -4.325   -4.014   -3.861   -3.715   -3.461 1.002</span></span>
<span><span class="co">## mu[4,1]    -4.653   0.307   -5.295   -4.856   -4.637   -4.437   -4.092 1.005</span></span>
<span><span class="co">## mu[5,1]    -4.574   0.417   -5.479   -4.833   -4.548   -4.282   -3.842 1.002</span></span>
<span><span class="co">## mu[6,1]    -4.617   0.245   -5.122   -4.774   -4.612   -4.451   -4.158 1.001</span></span>
<span><span class="co">## mu[7,1]    -3.721   0.273   -4.290   -3.901   -3.711   -3.530   -3.225 1.002</span></span>
<span><span class="co">## mu[1,2]    -3.718   0.198   -4.121   -3.848   -3.713   -3.582   -3.350 1.002</span></span>
<span><span class="co">## mu[2,2]    -3.045   0.104   -3.255   -3.115   -3.043   -2.973   -2.848 1.003</span></span>
<span><span class="co">## mu[3,2]    -3.272   0.115   -3.504   -3.348   -3.269   -3.192   -3.055 1.001</span></span>
<span><span class="co">## mu[4,2]    -3.680   0.130   -3.945   -3.765   -3.678   -3.588   -3.434 1.001</span></span>
<span><span class="co">## mu[5,2]    -4.342   0.257   -4.878   -4.507   -4.332   -4.165   -3.863 1.003</span></span>
<span><span class="co">## mu[6,2]    -3.777   0.113   -4.004   -3.852   -3.775   -3.699   -3.564 1.001</span></span>
<span><span class="co">## mu[7,2]    -3.704   0.199   -4.120   -3.830   -3.698   -3.569   -3.332 1.001</span></span>
<span><span class="co">## mu[1,3]    -3.776   0.147   -4.071   -3.873   -3.771   -3.673   -3.502 1.002</span></span>
<span><span class="co">## mu[2,3]    -3.382   0.076   -3.535   -3.434   -3.380   -3.331   -3.234 1.002</span></span>
<span><span class="co">## mu[3,3]    -3.495   0.085   -3.666   -3.551   -3.492   -3.435   -3.331 1.004</span></span>
<span><span class="co">## mu[4,3]    -3.626   0.092   -3.812   -3.688   -3.624   -3.562   -3.452 1.003</span></span>
<span><span class="co">## mu[5,3]    -3.779   0.115   -4.013   -3.856   -3.776   -3.700   -3.560 1.001</span></span>
<span><span class="co">## mu[6,3]    -3.716   0.064   -3.843   -3.760   -3.716   -3.673   -3.590 1.001</span></span>
<span><span class="co">## mu[7,3]    -3.603   0.152   -3.912   -3.704   -3.601   -3.500   -3.313 1.002</span></span>
<span><span class="co">## sd          0.759   0.301    0.340    0.542    0.703    0.915    1.495 1.003</span></span>
<span><span class="co">## deviance 2633.656   9.005 2617.935 2627.314 2632.974 2639.345 2652.835 1.001</span></span>
<span><span class="co">##          n.eff</span></span>
<span><span class="co">## d[1,1]       1</span></span>
<span><span class="co">## d[2,1]   10000</span></span>
<span><span class="co">## d[3,1]   10000</span></span>
<span><span class="co">## d[4,1]    1700</span></span>
<span><span class="co">## d[5,1]   10000</span></span>
<span><span class="co">## d[6,1]    3800</span></span>
<span><span class="co">## d[1,2]       1</span></span>
<span><span class="co">## d[2,2]   10000</span></span>
<span><span class="co">## d[3,2]   10000</span></span>
<span><span class="co">## d[4,2]    2400</span></span>
<span><span class="co">## d[5,2]    4800</span></span>
<span><span class="co">## d[6,2]    5900</span></span>
<span><span class="co">## d[1,3]       1</span></span>
<span><span class="co">## d[2,3]    2100</span></span>
<span><span class="co">## d[3,3]    1500</span></span>
<span><span class="co">## d[4,3]    9600</span></span>
<span><span class="co">## d[5,3]   10000</span></span>
<span><span class="co">## d[6,3]    2000</span></span>
<span><span class="co">## mu[1,1]   1800</span></span>
<span><span class="co">## mu[2,1]  10000</span></span>
<span><span class="co">## mu[3,1]   1200</span></span>
<span><span class="co">## mu[4,1]    340</span></span>
<span><span class="co">## mu[5,1]   1100</span></span>
<span><span class="co">## mu[6,1]   4100</span></span>
<span><span class="co">## mu[7,1]   1000</span></span>
<span><span class="co">## mu[1,2]   2300</span></span>
<span><span class="co">## mu[2,2]    630</span></span>
<span><span class="co">## mu[3,2]   2700</span></span>
<span><span class="co">## mu[4,2]  10000</span></span>
<span><span class="co">## mu[5,2]    840</span></span>
<span><span class="co">## mu[6,2]  10000</span></span>
<span><span class="co">## mu[7,2]  10000</span></span>
<span><span class="co">## mu[1,3]   2000</span></span>
<span><span class="co">## mu[2,3]   1400</span></span>
<span><span class="co">## mu[3,3]    520</span></span>
<span><span class="co">## mu[4,3]    810</span></span>
<span><span class="co">## mu[5,3]  10000</span></span>
<span><span class="co">## mu[6,3]   4400</span></span>
<span><span class="co">## mu[7,3]   1500</span></span>
<span><span class="co">## sd         700</span></span>
<span><span class="co">## deviance 10000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## For each parameter, n.eff is a crude measure of effective sample size,</span></span>
<span><span class="co">## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## DIC info (using the rule, pD = Dbar-Dhat)</span></span>
<span><span class="co">## pD = 41.2 and DIC = 2675.0</span></span>
<span><span class="co">## DIC is an estimate of expected predictive error (lower deviance is better).</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="post-processing-1">Post processing<a class="anchor" aria-label="anchor" href="#post-processing-1"></a>
</h3>
<p>Produce diagnostic plots to further assess convergence. Here, let’s select the random effects standard deviation. <strong>Figure</strong> Traceplot</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_traceplot.html" class="external-link">ggs_traceplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html" class="external-link">ggs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"sd"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-17-1.png" width="576"></p>
<p><strong>Figure</strong> Densityplot</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs_density.html" class="external-link">ggs_density</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggmcmc/man/ggs.html" class="external-link">ggs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"sd"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
<p>Save the FE results for later use.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">random_effects_model</span> <span class="op">&lt;-</span> <span class="va">model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="produce-outputs-of-interest">Produce outputs of interest<a class="anchor" aria-label="anchor" href="#produce-outputs-of-interest"></a>
</h2>
<p>Start with an object collecting all fits done.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fixed_effect_model</span>, <span class="va">random_effects_model</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="model-comparison">Model comparison<a class="anchor" aria-label="anchor" href="#model-comparison"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dcompare</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pwe_comparison.html">get_pwe_comparison</a></span><span class="op">(</span><span class="va">all_res</span><span class="op">)</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">dcompare</span>, caption <span class="op">=</span> <span class="st">"__Table__ Model comparison"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<caption>
<strong>Table</strong> Model comparison</caption>
<thead><tr class="header">
<th align="left">Model</th>
<th align="left">CutPoints</th>
<th align="left">DIC</th>
<th align="left">pD</th>
<th align="left">meanDev</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PWE</td>
<td align="left">3, 10</td>
<td align="left">2665.3</td>
<td align="left">36</td>
<td align="left">2629.3</td>
</tr>
<tr class="even">
<td align="left">PWE</td>
<td align="left">3, 10</td>
<td align="left">2675</td>
<td align="left">41.2</td>
<td align="left">2633.7</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="hazard-ratio-estimates">Hazard ratio estimates<a class="anchor" aria-label="anchor" href="#hazard-ratio-estimates"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop through fits</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">all_res</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">res_i</span> <span class="op">&lt;-</span> <span class="va">all_res</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">title</span> <span class="op">&lt;-</span> <span class="va">res_i</span><span class="op">$</span><span class="va">descr</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"### "</span>, <span class="va">title</span>, <span class="st">"  \n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Tables: Hazard ratio estimates for each segment</span></span>
<span>  <span class="va">HR_rev</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pwe_contrasts.html">get_pwe_contrasts</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">res_i</span>, </span>
<span>                             ref <span class="op">=</span> <span class="st">"A"</span>,  </span>
<span>                             digits <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                             exponentiate <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                             reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">HR_rev</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">x</span>, <span class="op">-</span><span class="va">xend</span><span class="op">)</span>, caption <span class="op">=</span> <span class="st">"__Table__ Hazard ratio estimates of A vs other treatments"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\n"</span><span class="op">)</span></span>
<span></span>
<span>  </span>
<span>  <span class="co">## Graphs (needs the HR data calculated above)</span></span>
<span>  <span class="va">ymax</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span>  <span class="va">dhr</span> <span class="op">&lt;-</span> <span class="va">HR_rev</span></span>
<span>  <span class="va">drib</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">dhr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"xend"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>,           <span class="co"># data structure for ribbons</span></span>
<span>                     ylo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">dhr</span><span class="op">$</span><span class="va">lCrI</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,                   <span class="co">#  cap ribbon at ymax</span></span>
<span>                     yup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">dhr</span><span class="op">$</span><span class="va">uCrI</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>                     Comparison <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">dhr</span><span class="op">$</span><span class="va">Comparison</span>, each <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>yup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">yup</span> <span class="op">&gt;</span> <span class="va">ymax</span>, <span class="va">ymax</span>, <span class="va">yup</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dhr</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">drib</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, ymin <span class="op">=</span> <span class="va">ylo</span>, ymax <span class="op">=</span> <span class="va">yup</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, xend <span class="op">=</span> <span class="va">xend</span>, y <span class="op">=</span> <span class="va">Median</span>, yend <span class="op">=</span> <span class="va">Median</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">Comparison</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="va">ymax</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Month"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Hazard ratio"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"__Figure__ Hazard ratio estimates A vs other treatments\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fig</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">res_i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="piecewise-exponential-model">Piecewise Exponential model<a class="anchor" aria-label="anchor" href="#piecewise-exponential-model"></a>
</h4>
<table class="table">
<caption>
<strong>Table</strong> Hazard ratio estimates of A vs other treatments</caption>
<thead><tr class="header">
<th align="left">Comparison</th>
<th align="left">Segment</th>
<th align="right">Median</th>
<th align="right">lCrI</th>
<th align="right">uCrI</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A vs B</td>
<td align="left">[0,3)</td>
<td align="right">0.786</td>
<td align="right">0.436</td>
<td align="right">1.416</td>
</tr>
<tr class="even">
<td align="left">A vs B</td>
<td align="left">[3,10)</td>
<td align="right">0.772</td>
<td align="right">0.584</td>
<td align="right">1.026</td>
</tr>
<tr class="odd">
<td align="left">A vs B</td>
<td align="left">[10,Inf)</td>
<td align="right">1.002</td>
<td align="right">0.839</td>
<td align="right">1.204</td>
</tr>
<tr class="even">
<td align="left">A vs C</td>
<td align="left">[0,3)</td>
<td align="right">1.175</td>
<td align="right">0.630</td>
<td align="right">2.174</td>
</tr>
<tr class="odd">
<td align="left">A vs C</td>
<td align="left">[3,10)</td>
<td align="right">0.650</td>
<td align="right">0.441</td>
<td align="right">0.957</td>
</tr>
<tr class="even">
<td align="left">A vs C</td>
<td align="left">[10,Inf)</td>
<td align="right">0.971</td>
<td align="right">0.717</td>
<td align="right">1.313</td>
</tr>
<tr class="odd">
<td align="left">A vs D</td>
<td align="left">[0,3)</td>
<td align="right">0.303</td>
<td align="right">0.117</td>
<td align="right">0.757</td>
</tr>
<tr class="even">
<td align="left">A vs D</td>
<td align="left">[3,10)</td>
<td align="right">0.653</td>
<td align="right">0.406</td>
<td align="right">1.031</td>
</tr>
<tr class="odd">
<td align="left">A vs D</td>
<td align="left">[10,Inf)</td>
<td align="right">0.918</td>
<td align="right">0.666</td>
<td align="right">1.267</td>
</tr>
<tr class="even">
<td align="left">A vs E</td>
<td align="left">[0,3)</td>
<td align="right">0.428</td>
<td align="right">0.150</td>
<td align="right">1.198</td>
</tr>
<tr class="odd">
<td align="left">A vs E</td>
<td align="left">[3,10)</td>
<td align="right">0.855</td>
<td align="right">0.514</td>
<td align="right">1.421</td>
</tr>
<tr class="even">
<td align="left">A vs E</td>
<td align="left">[10,Inf)</td>
<td align="right">0.953</td>
<td align="right">0.673</td>
<td align="right">1.362</td>
</tr>
<tr class="odd">
<td align="left">A vs F</td>
<td align="left">[0,3)</td>
<td align="right">1.445</td>
<td align="right">0.368</td>
<td align="right">5.822</td>
</tr>
<tr class="even">
<td align="left">A vs F</td>
<td align="left">[3,10)</td>
<td align="right">0.296</td>
<td align="right">0.144</td>
<td align="right">0.596</td>
</tr>
<tr class="odd">
<td align="left">A vs F</td>
<td align="left">[10,Inf)</td>
<td align="right">1.052</td>
<td align="right">0.672</td>
<td align="right">1.660</td>
</tr>
</tbody>
</table>
<p><strong>Figure</strong> Hazard ratio estimates A vs other treatments <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-22-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="piecewise-exponential-model-1">Piecewise Exponential model<a class="anchor" aria-label="anchor" href="#piecewise-exponential-model-1"></a>
</h4>
<table class="table">
<caption>
<strong>Table</strong> Hazard ratio estimates of A vs other treatments</caption>
<thead><tr class="header">
<th align="left">Comparison</th>
<th align="left">Segment</th>
<th align="right">Median</th>
<th align="right">lCrI</th>
<th align="right">uCrI</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A vs B</td>
<td align="left">[0,3)</td>
<td align="right">0.771</td>
<td align="right">0.174</td>
<td align="right">3.257</td>
</tr>
<tr class="even">
<td align="left">A vs B</td>
<td align="left">[3,10)</td>
<td align="right">0.772</td>
<td align="right">0.192</td>
<td align="right">3.073</td>
</tr>
<tr class="odd">
<td align="left">A vs B</td>
<td align="left">[10,Inf)</td>
<td align="right">1.004</td>
<td align="right">0.249</td>
<td align="right">3.841</td>
</tr>
<tr class="even">
<td align="left">A vs C</td>
<td align="left">[0,3)</td>
<td align="right">1.190</td>
<td align="right">0.261</td>
<td align="right">5.025</td>
</tr>
<tr class="odd">
<td align="left">A vs C</td>
<td align="left">[3,10)</td>
<td align="right">0.651</td>
<td align="right">0.160</td>
<td align="right">2.734</td>
</tr>
<tr class="even">
<td align="left">A vs C</td>
<td align="left">[10,Inf)</td>
<td align="right">0.970</td>
<td align="right">0.239</td>
<td align="right">3.918</td>
</tr>
<tr class="odd">
<td align="left">A vs D</td>
<td align="left">[0,3)</td>
<td align="right">0.305</td>
<td align="right">0.028</td>
<td align="right">3.029</td>
</tr>
<tr class="even">
<td align="left">A vs D</td>
<td align="left">[3,10)</td>
<td align="right">0.653</td>
<td align="right">0.072</td>
<td align="right">5.682</td>
</tr>
<tr class="odd">
<td align="left">A vs D</td>
<td align="left">[10,Inf)</td>
<td align="right">0.905</td>
<td align="right">0.105</td>
<td align="right">7.930</td>
</tr>
<tr class="even">
<td align="left">A vs E</td>
<td align="left">[0,3)</td>
<td align="right">0.420</td>
<td align="right">0.029</td>
<td align="right">6.013</td>
</tr>
<tr class="odd">
<td align="left">A vs E</td>
<td align="left">[3,10)</td>
<td align="right">0.863</td>
<td align="right">0.068</td>
<td align="right">9.486</td>
</tr>
<tr class="even">
<td align="left">A vs E</td>
<td align="left">[10,Inf)</td>
<td align="right">0.943</td>
<td align="right">0.079</td>
<td align="right">10.624</td>
</tr>
<tr class="odd">
<td align="left">A vs F</td>
<td align="left">[0,3)</td>
<td align="right">1.428</td>
<td align="right">0.110</td>
<td align="right">18.665</td>
</tr>
<tr class="even">
<td align="left">A vs F</td>
<td align="left">[3,10)</td>
<td align="right">0.295</td>
<td align="right">0.031</td>
<td align="right">2.988</td>
</tr>
<tr class="odd">
<td align="left">A vs F</td>
<td align="left">[10,Inf)</td>
<td align="right">1.054</td>
<td align="right">0.117</td>
<td align="right">9.603</td>
</tr>
</tbody>
</table>
<p><strong>Figure</strong> Hazard ratio estimates A vs other treatments <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-22-2.png" width="576"></p>
</div>
</div>
<div class="section level3">
<h3 id="survivor-function-estimates">Survivor function estimates<a class="anchor" aria-label="anchor" href="#survivor-function-estimates"></a>
</h3>
<p>The NMA baseline estimate from the <code>ref_trt</code> arm from <code>ref_std</code> is used. The contrast estimates from the NMA are then added to obtain the survivor functions for the other interventions.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ref_trt</span> <span class="op">&lt;-</span> <span class="st">"B"</span></span>
<span><span class="va">ref_std</span> <span class="op">&lt;-</span> <span class="st">"STUDY2"</span></span>
<span><span class="va">hor</span> <span class="op">&lt;-</span> <span class="fl">60</span></span>
<span></span>
<span><span class="co"># loop through fits</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">all_res</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">res_i</span> <span class="op">&lt;-</span> <span class="va">all_res</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">title</span> <span class="op">&lt;-</span> <span class="va">res_i</span><span class="op">$</span><span class="va">descr</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"### "</span>, <span class="va">title</span>, <span class="st">"  \n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## Plots of survivor functions over time ("NMA result"), ref study/arm and timehorizons specified in settings function</span></span>
<span>  <span class="va">sel_ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res_i</span><span class="op">$</span><span class="va">data.jg</span>, <span class="st">"d_arms"</span><span class="op">)</span><span class="op">$</span><span class="va">study</span> <span class="op">==</span> <span class="va">ref_std</span> <span class="op">&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res_i</span><span class="op">$</span><span class="va">data.jg</span>, <span class="st">"d_arms"</span><span class="op">)</span><span class="op">$</span><span class="va">treatment</span> <span class="op">==</span> <span class="va">ref_trt</span><span class="op">)</span></span>
<span>  <span class="va">id_ref_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res_i</span><span class="op">$</span><span class="va">data.jg</span>, <span class="st">"d_arms"</span><span class="op">)</span><span class="op">$</span><span class="va">studyn</span><span class="op">[</span><span class="va">sel_ref</span><span class="op">]</span></span>
<span>  <span class="va">id_ref_arm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res_i</span><span class="op">$</span><span class="va">data.jg</span>, <span class="st">"d_arms"</span><span class="op">)</span><span class="op">$</span><span class="va">arm</span><span class="op">[</span><span class="va">sel_ref</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">S_extrap</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pwe_S.html">get_pwe_S</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">res_i</span>,  </span>
<span>                        ref.std <span class="op">=</span> <span class="va">id_ref_std</span>, </span>
<span>                        ref.arm <span class="op">=</span> <span class="va">id_ref_arm</span>,  </span>
<span>                        time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">hor</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">S_extrap</span><span class="op">)</span> <span class="op">+</span>        </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">S</span>, col <span class="op">=</span> <span class="va">treatment</span>, linetype <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Month"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Survival probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"__Figure__ Survivor function estimates (time horizon:"</span>, <span class="va">hor</span>, <span class="st">"months) \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fig</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">S_extrap</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">treatment</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link">geom_ribbon</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, ymin <span class="op">=</span> <span class="va">lCrI</span>, ymax <span class="op">=</span> <span class="va">uCrI</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"lightblue"</span>, alpha <span class="op">=</span> <span class="fl">0.8</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">S</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Month"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Survival probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"__Figure__ Survivor function estimates by treatment (time horizon:"</span>, <span class="va">hor</span>, <span class="st">"months) \n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fig</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S_extrap"</span>, <span class="st">"fig"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">res_i</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="piecewise-exponential-model-2">Piecewise Exponential model<a class="anchor" aria-label="anchor" href="#piecewise-exponential-model-2"></a>
</h4>
<p><strong>Figure</strong> Survivor function estimates (time horizon: 60 months) <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-23-1.png" width="576"></p>
<p><strong>Figure</strong> Survivor function estimates by treatment (time horizon: 60 months) <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-23-2.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="piecewise-exponential-model-3">Piecewise Exponential model<a class="anchor" aria-label="anchor" href="#piecewise-exponential-model-3"></a>
</h4>
<p><strong>Figure</strong> Survivor function estimates (time horizon: 60 months) <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-23-3.png" width="576"></p>
<p><strong>Figure</strong> Survivor function estimates by treatment (time horizon: 60 months) <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-23-4.png" width="576"></p>
</div>
</div>
<div class="section level3">
<h3 id="model-fit-observed-km-data-vs-estimated-st">Model fit: observed KM data vs estimated S(t)<a class="anchor" aria-label="anchor" href="#model-fit-observed-km-data-vs-estimated-st"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop through fits</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">all_res</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">res_i</span> <span class="op">&lt;-</span> <span class="va">all_res</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">title</span> <span class="op">&lt;-</span> <span class="va">res_i</span><span class="op">$</span><span class="va">descr</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"### "</span>, <span class="va">title</span>, <span class="st">"  \n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">gof</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_pwe_GoF.html">get_pwe_GoF</a></span><span class="op">(</span>fit <span class="op">=</span> <span class="va">res_i</span>, </span>
<span>                     data.arms <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">res_i</span><span class="op">$</span><span class="va">data.jg</span>, <span class="st">"d_arms"</span><span class="op">)</span>,</span>
<span>                     data.jg <span class="op">=</span> <span class="va">res_i</span><span class="op">$</span><span class="va">data.jg</span><span class="op">)</span></span>
<span>   </span>
<span>  <span class="va">fig</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">gof</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"nma"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">S</span>, col <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">gof</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">type</span> <span class="op">==</span> <span class="st">"obs"</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">S</span>, col <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">study</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">ylim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Month"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Survival probability"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>, legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"__Figure__ Goodness-of-fit: estimated (solid lines) and observed (dashed) survivor functions for each study\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fig</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gof"</span>, <span class="st">"fig"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span>  </span></code></pre></div>
<div class="section level4">
<h4 id="piecewise-exponential-model-4">Piecewise Exponential model<a class="anchor" aria-label="anchor" href="#piecewise-exponential-model-4"></a>
</h4>
<p><strong>Figure</strong> Goodness-of-fit: estimated (solid lines) and observed (dashed) survivor functions for each study <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-24-1.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="piecewise-exponential-model-5">Piecewise Exponential model<a class="anchor" aria-label="anchor" href="#piecewise-exponential-model-5"></a>
</h4>
<p><strong>Figure</strong> Goodness-of-fit: estimated (solid lines) and observed (dashed) survivor functions for each study <img src="example-nma-groupedTTE-PWE_files/figure-html/unnamed-chunk-24-2.png" width="576"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop through fits</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">all_res</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">res_i</span> <span class="op">&lt;-</span> <span class="va">all_res</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">title</span> <span class="op">&lt;-</span> <span class="va">res_i</span><span class="op">$</span><span class="va">descr</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"## "</span>, <span class="va">title</span>, <span class="st">"  \n\n"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">jginfo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_jags_info.html">get_jags_info</a></span><span class="op">(</span><span class="va">res_i</span>, include.comments <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"```\n"</span>, <span class="va">jginfo</span>, <span class="st">"\n```\n\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">jginfo</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span>
<span><span class="op">}</span>  </span></code></pre></div>
<div class="section level3">
<h3 id="piecewise-exponential-model-6">Piecewise Exponential model<a class="anchor" aria-label="anchor" href="#piecewise-exponential-model-6"></a>
</h3>
<pre><code> ##############################################
# DATA                                       #
##############################################
list(
 Na  =  c(2, 2, 2, 2, 2, 2, 2) ,
 Ncuts  =  2 ,
 Nobs  =  675 ,
 Ns  =  7 ,
 Ntrt  =  6 ,
 a  =  c(2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2) ,
 dt  =  c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1) ,
 feprior_mean  =  0 ,
 feprior_prec  =  1e-04 ,
 n  =  c(182, 177, 172, 164, 155, 148, 143, 138, 132, 128, 125, 120, 117, 110, 108, 106, 101, 98, 96, 90, 87, 83, 79, 75, 70, 66, 59, 56, 53, 50, 47, 45, 39, 37, 34, 32, 31, 26, 25, 24, 23, 21, 19, 16, 14, 13, 11, 10, 8, 6, 5, 3, 1, 183, 179, 172, 159, 152, 147, 139, 133, 131, 124, 119, 115, 110, 104, 101, 95, 93, 92, 88, 83, 80, 76, 73, 68, 62, 59, 53, 50, 43, 40, 37, 35, 33, 31, 30, 29, 26, 24, 22, 19, 18, 18, 18, 18, 17, 17, 15, 14, 12, 10, 8, 4, 2, 322, 319, 309, 301, 288, 277, 262, 255, 248, 238, 229, 
226, 216, 206, 200, 195, 189, 183, 176, 171, 163, 160, 150, 148, 142, 136, 130, 127, 121, 116, 113, 112, 108, 105, 101, 101, 96, 95, 91, 89, 86, 84, 327, 324, 318, 307, 297, 283, 275, 263, 256, 248, 241, 235, 225, 217, 212, 201, 194, 184, 178, 169, 161, 156, 149, 142, 134, 131, 125, 117, 115, 107, 101, 96, 93, 89, 83, 79, 76, 74, 70, 68, 65, 63, 375, 374, 368, 360, 352, 339, 326, 319, 315, 308, 295, 289, 283, 271, 262, 259, 247, 238, 229, 225, 213, 203, 197, 190, 180, 161, 135, 121, 98, 78, 61, 55, 
52, 45, 39, 35, 375, 372, 356, 338, 319, 308, 295, 282, 276, 269, 260, 251, 242, 228, 221, 210, 203, 200, 187, 180, 172, 168, 161, 155, 149, 132, 115, 104, 82, 66, 53, 48, 43, 39, 34, 30, 181, 181, 180, 176, 172, 169, 167, 158, 153, 145, 143, 141, 137, 133, 129, 126, 123, 121, 118, 113, 112, 108, 105, 101, 99, 99, 98, 95, 92, 90, 88, 87, 86, 83, 82, 82, 78, 78, 78, 78, 181, 179, 176, 175, 173, 172, 169, 166, 165, 164, 159, 155, 150, 144, 140, 135, 132, 132, 132, 129, 127, 126, 123, 121, 116, 109, 
107, 105, 105, 104, 101, 97, 94, 93, 93, 90, 557, 552, 541, 532, 521, 505, 487, 473, 462, 452, 436, 423, 409, 388, 377, 368, 357, 348, 338, 328, 320, 312, 305, 295, 280, 273, 262, 255, 243, 235, 230, 226, 219, 215, 208, 204, 197, 184, 171, 156, 147, 147, 114, 114, 99, 99, 80, 77, 57, 48, 38, 27, 21, 20, 17, 14, 8, 6, 6, 1, 1, 553, 544, 530, 518, 501, 480, 468, 448, 435, 420, 406, 387, 377, 366, 354, 348, 339, 329, 321, 315, 304, 295, 283, 280, 272, 263, 254, 247, 237, 230, 224, 218, 212, 203, 192, 
187, 180, 174, 162, 149, 138, 131, 120, 111, 100, 92, 80, 63, 56, 48, 38, 31, 20, 17, 14, 11, 9, 7, 5, 5, 1, 189, 184, 178, 166, 156, 144, 138, 131, 123, 117, 111, 106, 103, 98, 93, 88, 85, 79, 74, 68, 64, 59, 55, 50, 46, 43, 40, 37, 35, 31, 28, 26, 25, 20, 19, 15, 15, 12, 10, 9, 9, 3, 3, 3, 3, 188, 179, 175, 167, 159, 151, 141, 136, 131, 127, 123, 117, 112, 106, 101, 96, 94, 88, 84, 77, 70, 64, 57, 52, 44, 39, 39, 30, 30, 26, 23, 21, 20, 16, 16, 12, 11, 11, 10, 8, 7, 4, 4, 2, 2, 2, 363, 360, 344, 
332, 314, 305, 286, 269, 261, 248, 236, 226, 220, 214, 199, 197, 188, 180, 177, 168, 162, 155, 151, 150, 148, 144, 140, 136, 128, 122, 118, 116, 113, 113, 109, 105, 98, 94, 87, 83, 75, 69, 64, 57, 53, 49, 46, 40, 37, 31, 25, 22, 18, 14, 10, 9, 7, 6, 3, 2, 1, 369, 366, 358, 347, 333, 322, 314, 302, 294, 277, 267, 254, 240, 236, 225, 218, 210, 197, 190, 179, 179, 173, 166, 163, 160, 154, 152, 148, 145, 143, 139, 136, 127, 123, 119, 118, 116, 112, 109, 106, 102, 99, 94, 85, 74, 66, 58, 50, 42, 35, 31, 
28, 25, 20, 17, 15, 13, 11, 6, 3, 2, 1, 1) ,
 r  =  c(2, 2, 4, 6, 4, 5, 4, 4, 4, 2, 5, 1, 7, 1, 1, 3, 1, 0, 3, 2, 1, 3, 2, 2, 2, 3, 1, 0, 0, 0, 1, 4, 1, 1, 1, 0, 4, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 4, 10, 4, 2, 6, 4, 0, 5, 3, 3, 3, 5, 1, 5, 1, 0, 3, 3, 3, 0, 0, 2, 2, 0, 3, 1, 3, 0, 1, 2, 0, 0, 0, 0, 2, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 3, 10, 7, 13, 10, 15, 7, 7, 9, 9, 3, 9, 10, 5, 5, 6, 5, 7, 5, 7, 3, 10, 1, 6, 6, 5, 3, 5, 5, 3, 0, 4, 3, 3, 0, 4, 1, 4, 1, 3, 2, 3, 2, 4, 9, 8, 12, 7, 11, 5, 7, 5, 4, 8, 7, 2, 10, 
6, 8, 4, 8, 6, 3, 5, 5, 6, 2, 5, 5, 1, 6, 5, 3, 1, 2, 5, 2, 1, 1, 2, 1, 1, 0, 0, 0, 5, 6, 7, 11, 12, 7, 3, 6, 12, 5, 6, 11, 8, 1, 11, 8, 8, 3, 10, 9, 4, 5, 9, 2, 6, 3, 2, 1, 2, 1, 0, 3, 0, 0, 0, 0, 13, 14, 15, 7, 10, 12, 5, 6, 7, 8, 8, 14, 7, 10, 7, 3, 13, 5, 5, 2, 4, 4, 3, 3, 1, 2, 5, 1, 1, 0, 2, 0, 0, 0, 0, 0, 1, 4, 4, 3, 2, 9, 5, 8, 2, 2, 4, 4, 4, 3, 3, 2, 3, 5, 1, 4, 3, 4, 2, 0, 1, 3, 3, 2, 2, 1, 1, 3, 1, 0, 4, 0, 0, 0, 0, 2, 3, 1, 2, 1, 3, 3, 1, 1, 5, 4, 5, 6, 4, 5, 3, 0, 0, 3, 2, 1, 3, 2, 5, 
7, 2, 2, 0, 1, 3, 4, 3, 1, 0, 3, 2, 3, 8, 6, 9, 14, 15, 10, 9, 8, 13, 11, 12, 21, 9, 8, 11, 9, 10, 9, 8, 6, 4, 6, 12, 4, 8, 4, 10, 6, 3, 1, 4, 2, 3, 2, 5, 5, 4, 6, 1, 0, 0, 0, 15, 0, 0, 3, 4, 1, 0, 0, 1, 0, 2, 0, 4, 0, 0, 0, 0, 0, 4, 8, 6, 12, 19, 9, 17, 11, 15, 12, 18, 10, 11, 11, 5, 9, 9, 6, 4, 10, 7, 9, 0, 5, 6, 6, 5, 7, 5, 5, 4, 3, 8, 9, 2, 6, 0, 5, 7, 3, 0, 3, 3, 6, 0, 3, 5, 1, 0, 0, 0, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 2, 2, 10, 7, 8, 3, 6, 4, 5, 4, 4, 0, 3, 3, 1, 1, 4, 3, 2, 2, 2, 2, 1, 1, 2, 
2, 0, 1, 3, 2, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 6, 2, 5, 5, 3, 8, 2, 4, 1, 2, 4, 3, 4, 4, 0, 2, 0, 3, 4, 1, 1, 0, 2, 3, 3, 0, 0, 0, 2, 0, 1, 1, 0, 0, 2, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 3, 15, 11, 18, 8, 19, 17, 8, 13, 11, 10, 6, 6, 15, 2, 8, 8, 3, 9, 6, 7, 4, 1, 2, 4, 4, 3, 8, 6, 4, 2, 3, 0, 4, 4, 7, 2, 4, 2, 4, 4, 3, 4, 1, 0, 0, 3, 0, 3, 2, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 3, 7, 11, 14, 10, 8, 12, 8, 17, 10, 13, 14, 4, 11, 7, 8, 13, 7, 11, 0, 6, 7, 3, 3, 6, 2, 3, 3, 2, 4, 3, 9, 4, 3, 
1, 2, 3, 1, 2, 2, 2, 4, 3, 5, 1, 2, 2, 2, 4, 0, 0, 0, 1, 0, 1, 1, 0, 3, 2, 0, 0, 0, 0) ,
 s  =  c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 
5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 
7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2) ,
 segment  =  c(1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3) ,
 t  = structure(.Data =  c(1, 3, 4, 5, 4, 5, 1, 4, 3, 6, 2, 1, 2, 3) ,.Dim =  c(7, 2) ) 
)

##############################################
# MODEL                                      #
##############################################
# Piecewise constant hazard model (=piecewise exponential) for digitized KM data, fixed effects
# -----------------------------------------------------------------------------------------------
# Apr 2017, Sandro Gsteiger

model{

## Sampling model (likelihood)
for (i in 1:Nobs){

  # likelihood: digitized KM curves
  r[i] ~ dbin(p[i], n[i])
  p[i] &lt;- 1 - exp(-h[i] * dt[i])  # cumulative hazard over interval [t,t+dt] expressed as deaths per person-month

  # piecewise constant model
  log(h[i]) &lt;- Beta[s[i], a[i], segment[i]]
}


## Arm level parameters = study effect + trt effect (consistency eq)
for (i in 1:Ns){
  for (j in 1:Na[i]){
    for (k in 1:(Ncuts + 1)){
      Beta[i, j, k] &lt;- mu[i, k] + d[t[i, j], k] - d[t[i, 1], k]
    }
  }
}
     
## Priors
for (i in 1:Ns){
  for (k in 1:(Ncuts + 1)){
    mu[i, k] ~ dnorm(feprior_mean, feprior_prec) 
  }
}

for (k in 1:(Ncuts + 1)){
  d[1, k] &lt;- 0
  for (i in 2:Ntrt){
    d[i, k] ~ dnorm(feprior_mean, feprior_prec) 
  }
}

} # end of model
############################################## </code></pre>
</div>
<div class="section level3">
<h3 id="piecewise-exponential-model-7">Piecewise Exponential model<a class="anchor" aria-label="anchor" href="#piecewise-exponential-model-7"></a>
</h3>
<pre><code> ##############################################
# DATA                                       #
##############################################
list(
 Na  =  c(2, 2, 2, 2, 2, 2, 2) ,
 Ncuts  =  2 ,
 Nobs  =  675 ,
 Ns  =  7 ,
 Ntrt  =  6 ,
 a  =  c(2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2) ,
 dt  =  c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 
1, 1, 1, 1, 1, 1, 1) ,
 feprior_mean  =  0 ,
 feprior_prec  =  1e-04 ,
 n  =  c(182, 177, 172, 164, 155, 148, 143, 138, 132, 128, 125, 120, 117, 110, 108, 106, 101, 98, 96, 90, 87, 83, 79, 75, 70, 66, 59, 56, 53, 50, 47, 45, 39, 37, 34, 32, 31, 26, 25, 24, 23, 21, 19, 16, 14, 13, 11, 10, 8, 6, 5, 3, 1, 183, 179, 172, 159, 152, 147, 139, 133, 131, 124, 119, 115, 110, 104, 101, 95, 93, 92, 88, 83, 80, 76, 73, 68, 62, 59, 53, 50, 43, 40, 37, 35, 33, 31, 30, 29, 26, 24, 22, 19, 18, 18, 18, 18, 17, 17, 15, 14, 12, 10, 8, 4, 2, 322, 319, 309, 301, 288, 277, 262, 255, 248, 238, 229, 
226, 216, 206, 200, 195, 189, 183, 176, 171, 163, 160, 150, 148, 142, 136, 130, 127, 121, 116, 113, 112, 108, 105, 101, 101, 96, 95, 91, 89, 86, 84, 327, 324, 318, 307, 297, 283, 275, 263, 256, 248, 241, 235, 225, 217, 212, 201, 194, 184, 178, 169, 161, 156, 149, 142, 134, 131, 125, 117, 115, 107, 101, 96, 93, 89, 83, 79, 76, 74, 70, 68, 65, 63, 375, 374, 368, 360, 352, 339, 326, 319, 315, 308, 295, 289, 283, 271, 262, 259, 247, 238, 229, 225, 213, 203, 197, 190, 180, 161, 135, 121, 98, 78, 61, 55, 
52, 45, 39, 35, 375, 372, 356, 338, 319, 308, 295, 282, 276, 269, 260, 251, 242, 228, 221, 210, 203, 200, 187, 180, 172, 168, 161, 155, 149, 132, 115, 104, 82, 66, 53, 48, 43, 39, 34, 30, 181, 181, 180, 176, 172, 169, 167, 158, 153, 145, 143, 141, 137, 133, 129, 126, 123, 121, 118, 113, 112, 108, 105, 101, 99, 99, 98, 95, 92, 90, 88, 87, 86, 83, 82, 82, 78, 78, 78, 78, 181, 179, 176, 175, 173, 172, 169, 166, 165, 164, 159, 155, 150, 144, 140, 135, 132, 132, 132, 129, 127, 126, 123, 121, 116, 109, 
107, 105, 105, 104, 101, 97, 94, 93, 93, 90, 557, 552, 541, 532, 521, 505, 487, 473, 462, 452, 436, 423, 409, 388, 377, 368, 357, 348, 338, 328, 320, 312, 305, 295, 280, 273, 262, 255, 243, 235, 230, 226, 219, 215, 208, 204, 197, 184, 171, 156, 147, 147, 114, 114, 99, 99, 80, 77, 57, 48, 38, 27, 21, 20, 17, 14, 8, 6, 6, 1, 1, 553, 544, 530, 518, 501, 480, 468, 448, 435, 420, 406, 387, 377, 366, 354, 348, 339, 329, 321, 315, 304, 295, 283, 280, 272, 263, 254, 247, 237, 230, 224, 218, 212, 203, 192, 
187, 180, 174, 162, 149, 138, 131, 120, 111, 100, 92, 80, 63, 56, 48, 38, 31, 20, 17, 14, 11, 9, 7, 5, 5, 1, 189, 184, 178, 166, 156, 144, 138, 131, 123, 117, 111, 106, 103, 98, 93, 88, 85, 79, 74, 68, 64, 59, 55, 50, 46, 43, 40, 37, 35, 31, 28, 26, 25, 20, 19, 15, 15, 12, 10, 9, 9, 3, 3, 3, 3, 188, 179, 175, 167, 159, 151, 141, 136, 131, 127, 123, 117, 112, 106, 101, 96, 94, 88, 84, 77, 70, 64, 57, 52, 44, 39, 39, 30, 30, 26, 23, 21, 20, 16, 16, 12, 11, 11, 10, 8, 7, 4, 4, 2, 2, 2, 363, 360, 344, 
332, 314, 305, 286, 269, 261, 248, 236, 226, 220, 214, 199, 197, 188, 180, 177, 168, 162, 155, 151, 150, 148, 144, 140, 136, 128, 122, 118, 116, 113, 113, 109, 105, 98, 94, 87, 83, 75, 69, 64, 57, 53, 49, 46, 40, 37, 31, 25, 22, 18, 14, 10, 9, 7, 6, 3, 2, 1, 369, 366, 358, 347, 333, 322, 314, 302, 294, 277, 267, 254, 240, 236, 225, 218, 210, 197, 190, 179, 179, 173, 166, 163, 160, 154, 152, 148, 145, 143, 139, 136, 127, 123, 119, 118, 116, 112, 109, 106, 102, 99, 94, 85, 74, 66, 58, 50, 42, 35, 31, 
28, 25, 20, 17, 15, 13, 11, 6, 3, 2, 1, 1) ,
 r  =  c(2, 2, 4, 6, 4, 5, 4, 4, 4, 2, 5, 1, 7, 1, 1, 3, 1, 0, 3, 2, 1, 3, 2, 2, 2, 3, 1, 0, 0, 0, 1, 4, 1, 1, 1, 0, 4, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 4, 10, 4, 2, 6, 4, 0, 5, 3, 3, 3, 5, 1, 5, 1, 0, 3, 3, 3, 0, 0, 2, 2, 0, 3, 1, 3, 0, 1, 2, 0, 0, 0, 0, 2, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 2, 0, 0, 3, 10, 7, 13, 10, 15, 7, 7, 9, 9, 3, 9, 10, 5, 5, 6, 5, 7, 5, 7, 3, 10, 1, 6, 6, 5, 3, 5, 5, 3, 0, 4, 3, 3, 0, 4, 1, 4, 1, 3, 2, 3, 2, 4, 9, 8, 12, 7, 11, 5, 7, 5, 4, 8, 7, 2, 10, 
6, 8, 4, 8, 6, 3, 5, 5, 6, 2, 5, 5, 1, 6, 5, 3, 1, 2, 5, 2, 1, 1, 2, 1, 1, 0, 0, 0, 5, 6, 7, 11, 12, 7, 3, 6, 12, 5, 6, 11, 8, 1, 11, 8, 8, 3, 10, 9, 4, 5, 9, 2, 6, 3, 2, 1, 2, 1, 0, 3, 0, 0, 0, 0, 13, 14, 15, 7, 10, 12, 5, 6, 7, 8, 8, 14, 7, 10, 7, 3, 13, 5, 5, 2, 4, 4, 3, 3, 1, 2, 5, 1, 1, 0, 2, 0, 0, 0, 0, 0, 1, 4, 4, 3, 2, 9, 5, 8, 2, 2, 4, 4, 4, 3, 3, 2, 3, 5, 1, 4, 3, 4, 2, 0, 1, 3, 3, 2, 2, 1, 1, 3, 1, 0, 4, 0, 0, 0, 0, 2, 3, 1, 2, 1, 3, 3, 1, 1, 5, 4, 5, 6, 4, 5, 3, 0, 0, 3, 2, 1, 3, 2, 5, 
7, 2, 2, 0, 1, 3, 4, 3, 1, 0, 3, 2, 3, 8, 6, 9, 14, 15, 10, 9, 8, 13, 11, 12, 21, 9, 8, 11, 9, 10, 9, 8, 6, 4, 6, 12, 4, 8, 4, 10, 6, 3, 1, 4, 2, 3, 2, 5, 5, 4, 6, 1, 0, 0, 0, 15, 0, 0, 3, 4, 1, 0, 0, 1, 0, 2, 0, 4, 0, 0, 0, 0, 0, 4, 8, 6, 12, 19, 9, 17, 11, 15, 12, 18, 10, 11, 11, 5, 9, 9, 6, 4, 10, 7, 9, 0, 5, 6, 6, 5, 7, 5, 5, 4, 3, 8, 9, 2, 6, 0, 5, 7, 3, 0, 3, 3, 6, 0, 3, 5, 1, 0, 0, 0, 2, 1, 2, 0, 0, 0, 0, 0, 0, 0, 2, 2, 10, 7, 8, 3, 6, 4, 5, 4, 4, 0, 3, 3, 1, 1, 4, 3, 2, 2, 2, 2, 1, 1, 2, 
2, 0, 1, 3, 2, 0, 1, 0, 1, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0, 6, 2, 5, 5, 3, 8, 2, 4, 1, 2, 4, 3, 4, 4, 0, 2, 0, 3, 4, 1, 1, 0, 2, 3, 3, 0, 0, 0, 2, 0, 1, 1, 0, 0, 2, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 0, 3, 15, 11, 18, 8, 19, 17, 8, 13, 11, 10, 6, 6, 15, 2, 8, 8, 3, 9, 6, 7, 4, 1, 2, 4, 4, 3, 8, 6, 4, 2, 3, 0, 4, 4, 7, 2, 4, 2, 4, 4, 3, 4, 1, 0, 0, 3, 0, 3, 2, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 3, 7, 11, 14, 10, 8, 12, 8, 17, 10, 13, 14, 4, 11, 7, 8, 13, 7, 11, 0, 6, 7, 3, 3, 6, 2, 3, 3, 2, 4, 3, 9, 4, 3, 
1, 2, 3, 1, 2, 2, 2, 4, 3, 5, 1, 2, 2, 2, 4, 0, 0, 0, 1, 0, 1, 1, 0, 3, 2, 0, 0, 0, 0) ,
 reprior_var_ln_mean  =  1 ,
 reprior_var_ln_prec  =  1.5 ,
 s  =  c(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 
5, 5, 5, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 
7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 
2, 2, 2, 2, 2, 2, 2) ,
 segment  =  c(1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 
3, 3, 3, 3, 3, 3, 3) ,
 t  = structure(.Data =  c(1, 3, 4, 5, 4, 5, 1, 4, 3, 6, 2, 1, 2, 3) ,.Dim =  c(7, 2) ) 
)

##############################################
# MODEL                                      #
##############################################
# Piecewise constant hazard model (=piecewise exponential) for digitized KM data, random effects
# Prior for between-trial-heterogeneity: log-normal for RE variance
# -----------------------------------------------------------------------------------------------
# Apr 2017, Sandro Gsteiger

model{

## Sampling model (likelihood)
for (i in 1:Nobs){

  # likelihood: digitized KM curves
  r[i] ~ dbin(p[i], n[i])
  p[i] &lt;- 1 - exp(-h[i] * dt[i])  # cumulative hazard over interval [t,t+dt] expressed as deaths per person-month

  # piecewise constant model
  log(h[i]) &lt;- Beta[s[i], a[i], segment[i]]
}


## Arm level parameters = study effect + trt effect (i.e. contrast)
for (i in 1:Ns){
  for (j in 1:Na[i]){
    for (k in 1:(Ncuts + 1)){
      Beta[i, j, k] &lt;- mu[i, k] + delta[i, j, k]
    }
  }
}


## Random effects (multi-arm correction; consistency eq for population parameters)
for (i in 1:Ns){
  # j=1
    for (k in 1:(Ncuts + 1)){
      w[i, 1, k] &lt;- 0
      delta[i, 1, k] &lt;- 0
    }

  # j&gt;1
  for (j in 2:Na[i]){
    for (k in 1:(Ncuts + 1)){
      delta[i, j, k] ~ dnorm(md[i, j, k], re.prec.d[i, j, k])
      md[i, j, k] &lt;- d[t[i, j], k] - d[t[i, 1], k] + sw[i, j, k]
      w[i, j, k] &lt;- (delta[i, j, k] - d[t[i, j], k] + d[t[i, 1], k])
      sw[i, j, k] &lt;- sum(w[i, 1:(j - 1), k]) / (j - 1) 
      re.prec.d[i, j, k] &lt;- re.prec * 2 * (j - 1) / j 
    }
  }
}




## Priors
for (i in 1:Ns){
  for (k in 1:(Ncuts + 1)){
    mu[i, k] ~ dnorm(feprior_mean, feprior_prec) 
  }
}

for (k in 1:(Ncuts + 1)){
  d[1, k] &lt;- 0
  for (i in 2:Ntrt){
    d[i, k] ~ dnorm(feprior_mean, feprior_prec) 
  }
}

sd2 ~ dlnorm(reprior_var_ln_mean, reprior_var_ln_prec)
re.prec &lt;- 1/sd2
sd &lt;- sqrt(sd2)

} # end of model
############################################## </code></pre>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/date.html" class="external-link">date</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Tue Jul 26 12:10:50 2022"</span></span></code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## R version 4.0.3 (2020-10-10)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Red Hat Enterprise Linux</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS/LAPACK: /usr/lib64/libopenblas-r0.2.20.so</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## locale:</span></span>
<span><span class="co">##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    </span></span>
<span><span class="co">##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span></span>
<span><span class="co">##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] ggmcmc_1.5.1.1  ggplot2_3.3.6   tidyr_1.2.0     gemtcPlus_1.0.0</span></span>
<span><span class="co">## [5] R2jags_0.7-1    rjags_4-13      gemtc_1.0-1     coda_0.19-4    </span></span>
<span><span class="co">## [9] dplyr_1.0.9    </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] Rcpp_1.0.9           lattice_0.20-41      assertthat_0.2.1    </span></span>
<span><span class="co">##  [4] rprojroot_1.3-2      digest_0.6.29        utf8_1.2.2          </span></span>
<span><span class="co">##  [7] R6_2.5.1             plyr_1.8.6           backports_1.1.10    </span></span>
<span><span class="co">## [10] evaluate_0.15        highr_0.9            pillar_1.8.0        </span></span>
<span><span class="co">## [13] rlang_1.0.4          rstudioapi_0.11      jquerylib_0.1.4     </span></span>
<span><span class="co">## [16] blob_1.2.1           rmarkdown_2.14       pkgdown_2.0.6       </span></span>
<span><span class="co">## [19] labeling_0.4.2       textshaping_0.1.2    desc_1.4.1          </span></span>
<span><span class="co">## [22] stringr_1.4.0        igraph_1.3.4         munsell_0.5.0       </span></span>
<span><span class="co">## [25] compiler_4.0.3       xfun_0.31            pkgconfig_2.0.3     </span></span>
<span><span class="co">## [28] systemfonts_0.3.2    htmltools_0.5.3      tidyselect_1.1.2    </span></span>
<span><span class="co">## [31] tibble_3.1.8         statnet.common_4.6.0 R2WinBUGS_2.1-21    </span></span>
<span><span class="co">## [34] reshape_0.8.8        fansi_1.0.3          crayon_1.5.1        </span></span>
<span><span class="co">## [37] withr_2.5.0          grid_4.0.3           jsonlite_1.8.0      </span></span>
<span><span class="co">## [40] GGally_2.1.2         gtable_0.3.0         lifecycle_1.0.1     </span></span>
<span><span class="co">## [43] DBI_1.1.0            magrittr_2.0.3       scales_1.1.1        </span></span>
<span><span class="co">## [46] cli_3.3.0            stringi_1.7.8        farver_2.1.1        </span></span>
<span><span class="co">## [49] fs_1.5.0             bslib_0.3.1          ellipsis_0.3.2      </span></span>
<span><span class="co">## [52] ragg_0.4.0           generics_0.1.3       vctrs_0.4.1         </span></span>
<span><span class="co">## [55] boot_1.3-25          RColorBrewer_1.1-2   tools_4.0.3         </span></span>
<span><span class="co">## [58] glue_1.6.2           purrr_0.3.4          network_1.17.2      </span></span>
<span><span class="co">## [61] abind_1.4-5          parallel_4.0.3       fastmap_1.1.0       </span></span>
<span><span class="co">## [64] yaml_2.2.1           colorspace_2.0-3     memoise_1.1.0       </span></span>
<span><span class="co">## [67] knitr_1.39           sass_0.4.2</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Sandro Gsteiger, Nick Howlett, Beth Ashlee.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
